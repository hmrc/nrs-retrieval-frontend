@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.AppConfig
@import models.SearchResult
@import views.helpers.Utils._
@import views.html.components._

@this(p: Paragraph)

@(searchResult: models.SearchResult, index: String)(implicit request: Request[_], messages: Messages, appConfig: AppConfig)

@timeSubmitted = {
  @formatDisplayDate(searchResult.submissionDateEpochMilli)
}

<div id="retrieve@index">
  <div id="result-retrieve-@index" class="result-retrieve" aria-live="polite" aria-busy="false">
    <h2 id="results-focus" class="retrieval-failed error-summary-heading" aria-hidden="true" role="alert" class="govuk-heading-l">
      @Messages("search.results.error.summary.lbl")
    </h2>
    <p>
      <span id ="retrieval-failed-@index" class="retrieval-failed govuk-body" aria-hidden="true">
        @Text(s"${Messages("search.results.cannot.retrieve.lbl")} ${searchResult.linkText} $timeSubmitted").asHtml
      </span>
      <span id="result-incomplete-@index" class="retrieval-incomplete govuk-body" aria-hidden="true" aria-label="@Messages("search.results.retrieval.message.lbl", searchResult.linkText)">
        @Text(s"${Messages("search.results.retrieval.message.lbl", searchResult.linkText)} $timeSubmitted").asHtml
        <br>
        @Text(s"${Messages("search.results.retrieval.info")}").asHtml
      </span>
        <a id="download-button-@index"
         class="retrieval-complete govuk-button govuk-button--secondary"
         role="button"
         aria-hidden="true"
         href="@{s"/nrs-retrieval/download/${searchResult.vaultId}/${searchResult.archiveId}"}"
         download="@searchResult.fileDetails">@Messages("search.results.download.lbl") @searchResult.linkText @timeSubmitted
      </a>
      <a id="start-retrieval-@index"
         class="start-retrieval govuk-link"
         data-index="@{index}"
         data-vault-id="@{searchResult.vaultId}"
         data-archive-id="@{searchResult.archiveId}"
         onclick="startRetrieval(this)"
         href="javascript:void(0)">@Messages("search.results.retrieve.lbl") @searchResult.linkText @timeSubmitted
      </a>
        @if(searchResult.hasAttachments) {
            <img class="attachment-image" src="@routes.Assets.versioned("images/attachment.png")" alt="@messages("search.results.attachment.image.fallback")" >
            }
    </p>
    @p(content = Text(s"${Messages("search.results.filename.lbl")}: ${searchResult.fileDetails}"))
    <span class="retrieval-failed govuk-body" aria-hidden="true">
        @p(content = Text(Messages("search.results.error.action.message.lbl")))
        @Html("""<a href="mailto:hmrc-ddcw-team-nonrepudiation-g@digital.hmrc.gov.uk">hmrc-ddcw-team-nonrepudiation-g@digital.hmrc.gov.uk</a>""")
    </span>
  </div>
</div>



